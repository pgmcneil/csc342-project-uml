<!Doctype html>
<html>
<head>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
	<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.9.1/jquery-ui.min.js"></script>
	<script>
		$(document).ready(function() {
			function objectTemplateWithID(id){
				return '<div class="object" id="object'+ id +'"> \
							<div class="header">	\
								<span class="objectTitle">Object ' + id + '</span> \
								<span class="settings"><img src="images/gear2.png" alt="Settings Menue Button" /></span> \
								<span class="delete">X</span> \
							</div>	\
							<div class="content" contenteditable="true">	\
								<table> \
									<tr><td>Sample attribute</tr> \
								</table> \
							</div>\
						</div>';
					
			};
			function createSettingsMenu(id) {
				return '<div class="settings-menu" reference="' + id + '"> \
					<div class="settings-content"> \
						<p>Settings go here</p> \
					</div> \
					<div class="prong"></div> \
					</div>';
			}
			function removeSettings() {
				$(".settings-menu").remove();
			}
			function checkID(id) {
				if(document.getElementById("object"+id)) {
					return checkID(++id);
				} else {
					return id;
				}
			}
			
			//hold value for zindex bring to front
			front = 0;
/*
 * LISTENERS
 * 
 */
			//Function to clear all the objects when Clear all is clicked
			$("#clear").click(function() {
				$(".object").each(function() {
					$(this).remove();
				});
			});
			$(document).on("click", ".object .header .delete", function(e){
					$(this).parent().parent().remove();
			});
			$("#canvas").on("dblclick", ".object", function(e){
				e.stopImmediatePropagation();
				return true;					
			});
			$("#canvas").on("mousedown", ".object", function(e){
				removeSettings();
				// //Bring to Front
				if($(this).css("z-index") != front){
					$(this).css("z-index", ++front);
				}
				//$("#zIndex").text( $(this).css("z-index")); //debug
				
				//Toggle Selected
				$(".selectedObject").removeClass("selectedObject");
				$(this).addClass("selectedObject");
			});
			
			
			//When the document is double clicked, spawn an object
			$("#canvas").on("dblclick", function(e) {
				
				//Position object so that the cursor is in the center of the header
				var id = 0;
				id = checkID(id);
				var newObject = objectTemplateWithID(id);
				$("#canvas").append(newObject);
				newObject = $("#object"+id);
				yPos = e.pageY - newObject.find(".header").height()/2;
				xPos = e.pageX - newObject.width()/2;
				
				
				//Add object and immediately select it
				newObject
					.offset({
						top: yPos,
						left: xPos
					})
					.draggable({containment: "parent"})
					.trigger("mousedown");
			});
			$(document).on("click", ".settings", function(e) {
				e.stopPropagation();
				if($(".settings-menu").length != 0) {
					return;
				}
				var object = $(this).parent().parent();
				var settings = createSettingsMenu(object.attr("id"));
				$("#canvas").append(settings);
				var xPos = object.offset().left;
				var yPos = object.offset().top - $(".settings-menu").height() - 20;
				if(yPos < $("#canvas").offset().top) {
					yPos = object.offset().top + object.height() + 20;
				}
				$(".settings-menu").offset({
					top: yPos,
					left: xPos
				});
			});
			$(document).on("click", function() {
				$(".settings-menu").remove();
			});
			$(document).on("click", ".settings-menu", function(e) {
				e.stopPropagation();
			});
			$(document).on("click", ".color", function() {
				$(".selectedObject").css("background-color", $(this).css("background-color"))
			});
			$(document).on("click", ".object .content", function(e) {
				$(this).focus();
				e.stopPropagation();
			});
			$(document).on("mousemove", ".object .content", function(e) {
				e.stopPropagation();
			});
		});
	</script>


	<style>
		body,html{
  			height:100%;
		}
		
		#canvas{
			height:100%;
		}
		#canvas div {
			display: inline-block;	
		}
		.object {
			width: 120px;
			height: 180px;
			position: absolute;
			background: #666;
			opacity: 0.8;
			border: 2px solid blue;	
			border-radius: 10px;

		}
		.object .header{
			color: white;
			position: relative;
			border-top-left-radius:5px;
			border-top-right-radius:5px;
			top: 0px;
			opacity: 1;
			background:blue;
			height:25px;
			width:100%;	
		
		}
		
		
		.object .objectTitle{
			position: absolute;
			top: 15%;	
			left:30%;
			-webkit-touch-callout: none;
			-webkit-user-select: none;
			-khtml-user-select: none;
			-moz-user-select: none;
			-ms-user-select: none;
			user-select: none;
		}
		.object .content {
			cursor: default;
		}
		.header .delete{
			float: right;
			cursor: pointer;
		}
		
			
		.color{
		
			width: 20px;
			height: 20px;
			margin:left;
	   

		}
		
		.color:hover{
		border: 1px solid #3399CC;
		
		
		}
		
		
		.object:hover {
			cursor: move;
		}
		.selectedObject{
			border: 2px solid red;	
			
		}
		.selectedObject .header{
			background: #f85032; /* Old browsers */
			background: -moz-linear-gradient(top, #f85032 0%, #f16f5c 50%, #f6290c 51%, #f02f17 71%, #FF0000 100%); /* FF3.6+ */
			background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#f85032), color-stop(50%,#f16f5c), color-stop(51%,#f6290c), color-stop(71%,#f02f17), color-stop(100%,#e73827)); /* Chrome,Safari4+ */
			background: -webkit-linear-gradient(top, #f85032 0%,#f16f5c 50%,#f6290c 51%,#f02f17 71%,#e73827 100%); /* Chrome10+,Safari5.1+ */
			
		}
		span {
			-webkit-touch-callout: none;
			-webkit-user-select: none;
			-khtml-user-select: none;
			-moz-user-select: none;
			-ms-user-select: none;
			user-select: none;
		}
		.object .header .settings {
			color: white;
			float: left;
		}
		.settings-menu {
			width: 200px;
			height: 100px;
			background-color: #fff;
			border: 1px solid #ccc;	
			border-radius: 10px;
			-webkit-box-shadow: 0px 0px 8px rgba(0,0,0,0.3);
			-moz-box-shadow:    0px 0px 8px rgba(0,0,0,0.3);
			box-shadow:         0px 0px 8px rgba(0,0,0,0.3);
		}
		.settings-menu .settings-content {
			margin: 10px;
		}
	</style>
</head>
<body>
   <form><input type="text" id="color" name="color" value="#123456" /></form>
    <div id="colorpicker"></div>
	<span id="clear">Clear all</span>
	
	
	<div>
		 <table>
            <tr>
                
				
				<td><div class="color" style="background-color: #00FF00"></div></td>
                <td><div class="color" style="background-color: #FF7F00	"></div></td>
                <td><div class="color" style="background-color: #FF0000"></div></td>
                <td><div class="color" style="background-color: #0000CD"></div></td>
				
            </tr>
            
            <tr>
                <td><div class="color" style="background-color: #70DB93"></div></td>
                <td><div class="color" style="background-color: #CAFF70"></div></td>
                <td><div class="color" style="background-color: #FFFF00"></div></td>
				<td><div class="color" style="background-color: #236B8E"></div></td>
            </tr>
			
            <tr>
                <td><div class="color" style="background-color: #5959AB"></div></td>
                <td><div class="color" style="background-color: #006400"></div></td>
                <td><div class="color" style="background-color: #800080"></div></td>
                <td><div class="color" style="background-color: #EE3B3B"></div></td>
            </tr>

					
  
         </table>

		 </div>
	<div id="canvas"></div>
	
	
	
</body>
</html>